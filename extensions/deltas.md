# Deltas

The following definition of the `stacks` field in `buildpack.toml` extends the [Data Format - buildpack.toml (TOML)](../buildpack.md#buildpack.toml-(toml)) section of the Buildpack Interface Specification.

```toml
[[stacks]]
id = "<stack ID>"
build-images = ["<build image tag>"]
run-images = ["<run image tag>"]
run-delta = "path/to/run.Dockerfile"
build-delta = "path/to/build.Dockerfile"
```

The `run-delta` and `build-delta` fields MUST contain paths to idempotent Dockerfiles if present.
These Dockerfiles MUST accept `stack` as a build argument, and SHOULD use `FROM $stack` to receive the argument.
These Dockerfiles MUST add the label `io.buildpacks.delta.<buildpack ID>@<buildpack version>` with any non-empty value to the OCI image config.

A platform MAY create a builder image by extending a stack build image with a buildpacks directory as specified in the [Buildpacks - Buildpacks Directory Layout](../platform.md#buildpacks-directory-layout) section of the Platform Interface Specification.
This builder image MUST be generated by successively applying the `build-delta` Dockerfiles from each included buildpack in succession before the buildpacks directory is added.
Additionally, an extended run image MUST be generated by successively applying the `run-delta` Dockerfiles from each included buildpack in succession.

App and launch layers generated using the builder image MUST be applied to the corresponding extended run image.
When a new run image is available, those layers SHOULD be rebased on the extended run image.
They MUST NOT be rebased on the original stack run image without `run-delta` modifications.

These build and run images SHOULD be treated as stack images and SHOULD be regenerated when new stack images are available.
